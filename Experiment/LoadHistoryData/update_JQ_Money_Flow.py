# encoding=utf-8"""数据库名字：stk_JQ_money_flowmysql 链接句柄 db_JQ_money_flow"""from Config.GlobalSetting import localDBInfofrom sdk.DBOpt import genDbConn, is_table_existimport pandas as pdfrom sdk.MyTimeOPT import minus_date_str, get_current_date_str, add_date_str""" -------------------------- 定义全局参数 -------------------------------- """start_date = '2009-01-01'end_date = get_current_date_str()(conn_JQ_MF, engine_JQ_MF) = genDbConn(localDBInfo, 'stk_JQ_money_flow')""" -------------------------- 获取 all stks -------------------------------- """all_stk_list = get_all_securities(types=['stock'], date=None)for stk in all_stk_list.index:    table_name = 's'+stk.split('.')[0]    if is_table_exist(conn=conn_JQ_MF, database_name='stk_JQ_money_flow', table_name=table_name):        # 读取原表，并获取最后的日期        df = pd.read_sql('select * from ' + table_name, con=conn_JQ_MF)        date_last = str(df.sort_values(by='date', ascending=True).tail(1)['date'].values[0])[:10]        # 判断是否是最新日期        if minus_date_str(date_last, get_current_date_str()) >= 0:            print(stk + ' 表中的日期已经是最新的了！不需要更新！')            continue        df = get_money_flow(stk, start_date=add_date_str(date_last, 1), end_date=end_date)        if df.empty:            print(stk + ' 没有相应时间段的数据！')            continue        else:            df.to_sql(con=engine_JQ_MF, name=table_name, if_exists='append', index=False)    else:        df = get_money_flow(stk, start_date=start_date, end_date=end_date)        if df.empty:            print(stk + ' 没有相应时间段的数据！')            continue        else:            df.to_sql(con=engine_JQ_MF, name=table_name, if_exists='replace', index=False)